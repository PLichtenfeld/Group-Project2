---
title: "Group Project 2"
author: "Paul Lichtenfeld"
date: "2024-05-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- c("knitr", "kableExtra", "magrittr", "readr", "geosphere", "plyr", "dplyr", "kable", "tidyverse", "tibble", "ggplot2","reshape2","stringr","leaflet")

install_me <- packages[!(packages %in% installed.packages()[, "Package"])]
#if (length(install_me)) install.packages(install_me)

library(knitr)
library(geosphere)
library(plyr)
library(dplyr)
library(kableExtra)
library(tibble)
library(tidyverse)
library(ggplot2)
library(reshape2)
library(stringr)
library(leaflet)
devtools::install_github("haozhu233/kableExtra")
```

## Objective 1 
The objective was to create an interactive map for both the global death dataset and the global confirmation dataset. The first thing I did was read in the two data frames. Next I modified the death data set. First I set a variable to be the column name of the final column in the data set. I then created a new variable which held the data set grouped by the country, averaged out the latitude and longitude for countries with multiple entries, and summed the total number of deaths for countries with multiple entries. I then did the same for the confirmed data set. I then made two data frames which held the labels, latitude, longitude, and the total number of confirmations/deaths for the visualization. I then wrote the color palettes for the two map layers. I then created the visualization, passed it map tiles and set two different toggleable groups, one for the confirmed data set and one for the death data set. 

```{r Obj1}
#two necessary data frames
deathGlobal<- read.csv("time_series_covid19_deaths_global (1).csv", header = TRUE)
confirmedGlobal <- read.csv("time_series_covid19_confirmed_global (2).csv", header = TRUE)

#modifies the death data set to what I need 
finColNameDeath <- (colnames(deathGlobal[ncol(deathGlobal)]))
newDeath <- deathGlobal %>% group_by(Country.Region) %>% summarize(averageLat=mean(Lat, na.rm=TRUE), averageLong=(mean(Long,na.rm = TRUE)), totalDeaths=sum(.data[[finColNameDeath]]))


#modifies the confirmed dataset to be what I need it to be 
finColNameConfirm <- colnames(confirmedGlobal[ncol(confirmedGlobal)])
newConfirm <- confirmedGlobal %>% group_by(Country.Region) %>% summarize(averageLat=mean(Lat,na.rm = TRUE),averageLong=mean(Long,na.rm = TRUE),totalConfirms=sum(.data[[finColNameConfirm]]))



#Creates a data frame for the visualization 
confirmLocations <- data.frame(
  label = (deframe(newConfirm[,1])),
  latitude = deframe(newConfirm[,2]),
  longitude = deframe(newConfirm[,3]),
  totalConfirms = deframe(newConfirm[,4])
  
)
#creates a data frame for the death part of the visualization 
deathLocations <- data.frame(
  label = deframe(newDeath[,1]),
  latitude = deframe(newDeath[,2]),
  longitude = deframe(newDeath[,3]),
  totalDeaths = deframe(newDeath[,4])
)

#color pallette function call 
pal <- colorFactor(c("navy","purple","red"), domain= newConfirm$totalConfirms)
secPal <- colorFactor(c("navy","purple","red"), domain= newDeath$totalDeaths)

#creates interactive visualization 
leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>%
  #first circle group for the confirmed data set 
  addCircles(
    data = confirmLocations,
    lat = ~latitude,
    lng = ~ longitude,
    popup = ~as.character(totalConfirms),
    label = ~label,
    radius = 190000,
    stroke = FALSE, fillOpacity = 0.5, 
    color = ~pal(totalConfirms),
    group = "Confirmations"
  )%>%
  addCircles(
    #second circle group for the death data set 
    data = deathLocations,
    lat= ~latitude,
    lng = ~longitude,
    popup = ~as.character(totalDeaths),
    label = ~label, 
    radius = 190000,
    stroke = FALSE, fillOpacity = 0.5, 
    color = ~secPal(totalDeaths),
    group = "Deaths"
  )%>%
  #controls the two possible layers for the visualization
  addLayersControl(
    overlayGroups = c("Confirmations","Deaths"),
    options = layersControlOptions(collapsed = FALSE)
  )

```

## Objective 2 

This objective had to do with creating a chart with kable to show the order of countries in descending order by deaths/confirmations. The first thing I did was make new data frames with only the information I needed. I then called **knitr::kables** and created two kable charts in the list. I added captions and column names to create the two charts next to each other. 
```{r Obj2}
#sets a new data frame for the confirmation data set 
newerConfirm <- select(newConfirm, Country.Region, totalConfirms)
newerConfirm <- data.frame(newerConfirm %>% arrange(desc(totalConfirms)))

#sets a new data frame for the death data set
newerDeath <- select(newDeath, Country.Region, totalDeaths)
newerDeath <- data.frame(newerDeath %>% arrange(desc(totalDeaths)))



#Sets two charts and sets them next to each other
knitr::kables(
  list(
    #First chart
    knitr::kable(
      newerConfirm, col.names = c("Country","Count"), valign='t', caption = "Confirms"
    ),
    #Second chart
    knitr::kable(newerDeath, digits = 0, valign='t', col.names = c("Country","Count"), caption = "Death")
    
    
  ),
  
 
)


```

